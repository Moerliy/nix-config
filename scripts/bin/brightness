#!/usr/bin/env bash

## Script To Manage Brightness For Archcraft (in Wayland).

iDIR="$HOME/.config/mako/icons"
NIGHT_TEMPERATUR=5000
NORMAL_TEMPERATUR=6000

# Get brightness
get_backlight() {
  LIGHT=$(hyprctl hyprsunset gamma | cut -d '.' -f 1)
  echo "${LIGHT}"
}

# Get icons
get_icon() {
  backlight="$(get_backlight)%"
  current="${backlight%%%}"
  if [[ ("$current" -ge "0") && ("$current" -le "20") ]]; then
    icon="$iDIR/brightness-20.png"
  elif [[ ("$current" -ge "20") && ("$current" -le "40") ]]; then
    icon="$iDIR/brightness-40.png"
  elif [[ ("$current" -ge "40") && ("$current" -le "60") ]]; then
    icon="$iDIR/brightness-60.png"
  elif [[ ("$current" -ge "60") && ("$current" -le "80") ]]; then
    icon="$iDIR/brightness-80.png"
  elif [[ ("$current" -ge "80") && ("$current" -le "100") ]]; then
    icon="$iDIR/brightness-100.png"
  fi
}

# Notify
notify_user() {
  notify-send -h string:x-canonical-private-synchronous:sys-notify -u low -i "$icon" "Brightness : $(get_backlight)%"
}

# Increase brightness
inc_backlight() {
  # Calculate new backlight value
  current=$(get_backlight)
  new_value=$((current + 5))
  if [[ $new_value -gt 100 ]]; then
    new_value=100
  fi

  # Apply new backlight value
  hyprctl hyprsunset gamma $new_value && get_icon && notify_user
}

# Decrease brightness
dec_backlight() {
  current=$(get_backlight)
  new_value=$((current - 5))
  if [[ $new_value -lt 0 ]]; then
    new_value=0
  fi
  hyprctl hyprsunset gamma $new_value && get_icon && notify_user
}

toggle_night_mode() {
  CURRENT_TEMP=$(hyprctl hyprsunset temperature)
  # if not eq normarl temperature, set to normal
  if [[ "$CURRENT_TEMP" -ne "$NORMAL_TEMPERATUR" ]]; then
    hyprctl hyprsunset temperature "$NORMAL_TEMPERATUR"
    notify-send -h string:x-canonical-private-synchronous:sys-notify -u low -i "$iDIR/brightness-100.png" "Night Mode : Off"
    exit 0
  fi
  hyprctl hyprsunset temperature "$NIGHT_TEMPERATUR"
  notify-send -h string:x-canonical-private-synchronous:sys-notify -u low -i "$iDIR/brightness-40.png" "Night Mode : On"
  exit 0
}

# Execute accordingly
if [[ "$1" == "--get" ]]; then
  get_backlight
elif [[ "$1" == "--inc" ]]; then
  inc_backlight
elif [[ "$1" == "--dec" ]]; then
  dec_backlight
elif [[ "$1" == "--toggle-night-mode" ]]; then
  toggle_night_mode
else
  get_backlight
fi
